<!DOCTYPE html>

<html lang="python" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Installation of ESP/CAPS &#8212; TACS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css?v=34905f61" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=d048f138"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Postprocessing TACS Solutions" href="../postprocessing.html" />
    <link rel="prev" title="caps2tacs" href="caps2tacs.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../postprocessing.html" title="Postprocessing TACS Solutions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="caps2tacs.html" title="caps2tacs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TACS  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../interfaces.html" >Interfaces</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="caps2tacs.html" accesskey="U">caps2tacs</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation of ESP/CAPS</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="installation-of-esp-caps">
<h1>Installation of ESP/CAPS<a class="headerlink" href="#installation-of-esp-caps" title="Link to this heading">¶</a></h1>
<p>The link to the main Engineering Sketch Pad webiste is the following, <a class="reference external" href="https://acdl.mit.edu/ESP/">ESP/CAPS</a>.
A prebuilt distribution can be found in the <code class="docutils literal notranslate"><span class="pre">PreBuilts/</span></code> folder. The following environment variables must be setup in the ~/.bashrc file.
The serveCSM command is useful in viewing the ESP/CAPS geometry from a .csm file. The alias csm
can be useful if one is running <code class="docutils literal notranslate"><span class="pre">serveCSM</span></code> command repeatedly (optional). Note the <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">*</span></code> command
won't work until after the full install so you can ignore that if you source it immediately.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export ESP_ROOT=~/packages/ESP123/EngSketchPad
export PYTHONPATH=${PYTHONPATH}:$ESP_ROOT/pyESP
source $ESP_ROOT/ESPenv.sh
alias csm=&#39;$ESP_ROOT/bin/serveCSM&#39;
</pre></div>
</div>
<p>The installation on a Linux machine proceeds as follows. Note if the ESP/OpenCASCADE version changes
past ESP123, change the bashrc and install commands accordingly. The basic steps involve downloading the tar,
unpacking it, and informing ESP/CAPS of the location of the OpenCASCADE directory (which comes with the prebuilt).
Then, as the package is a prebuilt, we only need to make the tacsAIM directory which is not usually auto-built
(don't need to make the rest of the source folder).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">packages</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">~/</span><span class="n">packages</span><span class="o">/</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">acdl</span><span class="o">.</span><span class="n">mit</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">ESP</span><span class="o">/</span><span class="n">PreBuilts</span><span class="o">/</span><span class="n">ESP123</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">aarch64</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="o">*.</span><span class="n">tgz</span>
<span class="n">cd</span> <span class="o">./</span><span class="n">ESP123</span><span class="o">/</span><span class="n">EngSketchPad</span><span class="o">/</span><span class="n">config</span><span class="o">/</span>
<span class="o">./</span><span class="n">makeEnv</span> <span class="o">~/</span><span class="n">packages</span><span class="o">/</span><span class="n">ESP123</span><span class="o">/</span><span class="n">OpenCASCADE</span><span class="o">-</span><span class="mf">7.7.0</span><span class="o">/</span>
<span class="n">cd</span> <span class="n">src</span><span class="o">/</span><span class="n">CAPS</span><span class="o">/</span><span class="n">aim</span><span class="o">/</span><span class="n">tacs</span><span class="o">/</span>
<span class="n">make</span>
</pre></div>
</div>
<p>The caps2tacs python module will not be imported unless ESP/CAPS is properly installed on your machine.</p>
</section>
<section id="intro">
<h1>Intro<a class="headerlink" href="#intro" title="Link to this heading">¶</a></h1>
<p>The differentiable CAD geometry in ESP/CAPS is defined in a CSM or Computational Solid Model file.
The user must write their own CSM file (see ESP/CAPS tutorials on their website) to define a structures geometry.
Important things to include in your CSM file are included below (for reference see the file <code class="docutils literal notranslate"><span class="pre">examples/caps_wing/simple_naca_wing.csm</span></code>).</p>
<ul class="simple">
<li><p>Configuration parameters such as <code class="docutils literal notranslate"><span class="pre">cfgpmtr</span> <span class="pre">nribs</span> <span class="pre">10</span></code> which are integer variables usually fixed during optimization.</p></li>
<li><p>Design parameters such as <code class="docutils literal notranslate"><span class="pre">despmtr</span> <span class="pre">span</span> <span class="pre">10</span></code> which are real number variables that can be tied to a TACS shape variable.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">capsGroup</span></code> attributes define regions of the geometry with the same property cars, denoted <code class="docutils literal notranslate"><span class="pre">capsGroup</span> <span class="pre">$rib1</span></code>, etc.</dt><dd><p>We often use pattern statements to define these, and sometimes a user-defined primitive <code class="docutils literal notranslate"><span class="pre">udprim</span> <span class="pre">editAttr</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">capsConstraint</span></code> attributes define regions of the geometry intended to have the same structural constraints, e.g. <code class="docutils literal notranslate"><span class="pre">capsConstraint</span> <span class="pre">fix</span></code>.</dt><dd><p>These constraints include Temperature and elastic constraints as of right now.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">capsLoad</span></code> attributes define regions of the geometry with the same fixed loads.</dt><dd><p>This is useful in simple structural analyses. Note that aerodynamic loads cannot be setup this way (see the funtofem github for how to do this).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">capsAIM</span></code> attribute - this specifies for a body the analysis tools or AIMs using this CSM file.</dt><dd><p>Note that we often add the <code class="docutils literal notranslate"><span class="pre">tacsAIM,</span> <span class="pre">egadsTessAIM</span></code> here for structural analyses.</p>
</dd>
</dl>
</li>
<li><p>Occasionally <code class="docutils literal notranslate"><span class="pre">capsMesh</span></code> attribute - which can be used to set alternative auto-mesh settings on different sections of the geometry.</p></li>
</ul>
<p>The main <code class="docutils literal notranslate"><span class="pre">TacsModel</span></code> object supervises the process of TACS analysis and geometry updates for optimization.
Caps2tacs supports MPI / parallel processing which is a feature not directly available in ESP/CAPS.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="n">tacs_model</span> <span class="o">=</span> <span class="n">caps2tacs</span><span class="o">.</span><span class="n">TacsModel</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">csm_file</span><span class="o">=</span><span class="s2">&quot;simple_naca_wing.csm&quot;</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, the user must specify the auto mesh generation settings for the structure geometry that will be
used in the TACS analysis. The global mesh size depends on the scale of the model. You'll want to tune these auto-mesh
hyperparameters by running a small analysis / using egadsAIM view routine until you get a quality mesh.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tacs_model</span><span class="o">.</span><span class="n">mesh_aim</span><span class="o">.</span><span class="n">set_mesh</span><span class="p">(</span>
   <span class="n">edge_pt_min</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
   <span class="n">edge_pt_max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
   <span class="n">global_mesh_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
   <span class="n">max_surf_offset</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
   <span class="n">max_dihedral_angle</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">register_to</span><span class="p">(</span><span class="n">tacs_model</span><span class="p">)</span>
</pre></div>
</div>
<p>There are certain objects that must be setup and registered to the tacs model before running a TACS analysis.
If these are not correctly specified, then the tacs model will throw an error in the setup check phase.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Material properties - you must setup one or more material objects for use in the element property definitions.</dt><dd><p>Available material types include Isotropic and Orthotropic (Anisotropic can be added directly through the underlying tacsAIM). Several common materials are saved as class methods such as aluminum, steel, titanium, carbon fiber.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Element Properties - currently caps2tacs only supports shell elements for use in aerodynamic structures.</dt><dd><p>Element properties can be setup directly through a <cite>ShellProperty</cite> object or indirectly through the <cite>ThicknessVariable</cite> object.
The names of shell properties or the thickness variables must be tied to a <cite>capsGroup</cite> setup in the CSM file.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Constraints - elastic and thermal constraints are available in caps2tacs. Common instances are the <code class="docutils literal notranslate"><span class="pre">PinConstraint</span></code> and <code class="docutils literal notranslate"><span class="pre">TemperatureConstraint</span></code>.</dt><dd><p>The name/capsConstraint input to these constraint objects must match the <code class="docutils literal notranslate"><span class="pre">capsConstraint</span></code> attributes in the CSM file.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Loads - for static problems <code class="docutils literal notranslate"><span class="pre">GridForce</span></code> and <code class="docutils literal notranslate"><span class="pre">Pressure</span></code> load objects are available whose names must match the <code class="docutils literal notranslate"><span class="pre">capsLoad</span></code> attributes.</dt><dd><p>Note that for aerodynamic structures only coupling with a CFD software such as through the <code class="docutils literal notranslate"><span class="pre">FUNtoFEM</span> <span class="pre">repo</span> <span class="pre">(see</span> <span class="pre">below</span></code> can setup aerodynamic loads.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Output Functionals for optimization - functionals such as <code class="docutils literal notranslate"><span class="pre">ksfailure</span></code>, <code class="docutils literal notranslate"><span class="pre">mass</span></code>, <code class="docutils literal notranslate"><span class="pre">temperature</span></code>, <code class="docutils literal notranslate"><span class="pre">compliance</span></code></dt><dd><p>are available for use in structural optimizations.</p>
</dd>
</dl>
</li>
</ul>
<p>Once all of the above structural analysis setup objects are provided, the TacsModel is ready for analysis. You can
then run the setup method which completes the setup phase. Then, the routines <code class="docutils literal notranslate"><span class="pre">pre_analysis()</span></code> generates a mesh,
the routine <code class="docutils literal notranslate"><span class="pre">run_analysis</span></code> runs the structural analysis and writes output solution files.
Finally the routine <code class="docutils literal notranslate"><span class="pre">post_analysis()</span></code> saves output functional values and derivatives using the adjoint method for optimization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tacs_model</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">include_aim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tacs_model</span><span class="o">.</span><span class="n">pre_analysis</span><span class="p">()</span>
<span class="n">tacs_model</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">()</span>
<span class="n">tacs_model</span><span class="o">.</span><span class="n">post_analysis</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<p>The main caps2tacs example is in the directory <code class="docutils literal notranslate"><span class="pre">./examples/caps_wing/</span></code>, with five analyses
on a coarse mesh of a symmetric NACA 0012 wing structure.
1. A steady analysis, using the EGADS AIM for meshing, with a vertical distributed load.
2. An unsteady analysis with a vertical distributed load varying sinusoidally in time.
3. A sizing optimization which finds the optimal panel thicknesses to hold fixed aero loads.
4. A sizing and shape optimization which optimizes the panel thicknesses and location of ribs</p>
<blockquote>
<div><p>and spars inside the wing to hold fixed aero loads.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>A steady analysis, using the AFLR AIM for meshing, with a vertical distributed load.</p></li>
</ol>
<p>The sizing optimization shown below resulted in about a 40% drop in weight from the equal thickness design. Notice
the optimal design has the largest panel thicknesses near the root as this is related to a beam bending problem
with clamped root.</p>
<a class="reference internal image-reference" href="../_images/c2tacs1.png"><img alt="Sizing optimization history - results in about a 40\% drop in weight from the equal thickness design." src="../_images/c2tacs1.png" style="width: 400px;" />
</a>
<a class="reference internal image-reference" href="../_images/c2tacs2.png"><img alt="Optimal design from the sizing optimization." src="../_images/c2tacs2.png" style="width: 400px;" />
</a>
<p>The optimization results for the sizing + shape optimization are shown below, which resulted in a 27% drop in weight
from the optimal design of the sizing optimization. This suggests that the placement of ribs and spars is very important
in designing a good wing structure. In this case, the spars move towards the leading edge with higher curvature.</p>
<a class="reference internal image-reference" href="../_images/c2tacs3.png"><img alt="Sizing + Shape optimization history - results in about a 27\% drop in weight from the pure sizing optimal design." src="../_images/c2tacs3.png" style="width: 400px;" />
</a>
<a class="reference internal image-reference" href="../_images/c2tacs4.png"><img alt="Optimal design from the sizing + shape optimization, notice the optimal placement of ribs and spars to hold the vertical distributed loads." src="../_images/c2tacs4.png" style="width: 400px;" />
</a>
<p>For more examples using caps2tacs for thermoelastic analysis and involving CFD, please see the
<a class="reference external" href="https://github.com/smdogroup/funtofem/">FUNtoFEM github</a>.</p>
</section>
<section id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h1>
<p>Two different unittests can be used to verify your build of ESP/CAPS and TACS is working correctly. The unittests
are located at <code class="docutils literal notranslate"><span class="pre">tests/integration_tests/test_caps_shape_derivatives.py</span></code> and <code class="docutils literal notranslate"><span class="pre">tests/integration_tests/test_caps_thick_derivatives.py</span></code>.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Installation of ESP/CAPS</a></li>
<li><a class="reference internal" href="#intro">Intro</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="caps2tacs.html"
                          title="previous chapter">caps2tacs</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../postprocessing.html"
                          title="next chapter">Postprocessing TACS Solutions</a></p>
  </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../postprocessing.html" title="Postprocessing TACS Solutions"
             >next</a> |</li>
        <li class="right" >
          <a href="caps2tacs.html" title="caps2tacs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TACS  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../interfaces.html" >Interfaces</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="caps2tacs.html" >caps2tacs</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation of ESP/CAPS</a></li> 
      </ul>
    </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>