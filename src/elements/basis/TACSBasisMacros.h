/*
  This file is part of TACS: The Toolkit for the Analysis of Composite
  Structures, a parallel finite-element code for structural and
  multidisciplinary design optimization.

  Copyright (C) 2014 Georgia Tech Research Corporation

  TACS is licensed under the Apache License, Version 2.0 (the
  "License"); you may not use this software except in compliance with
  the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0
*/

#ifndef TACS_BASIS_MACROS_H
#define TACS_BASIS_MACROS_H

#define TACS_BASIS_EVAL_TENSOR2D_ORDER2(n1, n2, m, v) \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m]) +         \
      n2[1] * (n1[0] * v[2 * m] + n1[1] * v[3 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER3(n1, n2, m, v)                    \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m]) +         \
      n2[1] * (n1[0] * v[3 * m] + n1[1] * v[4 * m] + n1[2] * v[5 * m]) + \
      n2[2] * (n1[0] * v[6 * m] + n1[1] * v[7 * m] + n1[2] * v[8 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER4(n1, n2, m, v)                      \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +            \
           n1[3] * v[3 * m]) +                                             \
      n2[1] * (n1[0] * v[4 * m] + n1[1] * v[5 * m] + n1[2] * v[6 * m] +    \
               n1[3] * v[7 * m]) +                                         \
      n2[2] * (n1[0] * v[8 * m] + n1[1] * v[9 * m] + n1[2] * v[10 * m] +   \
               n1[3] * v[11 * m]) +                                        \
      n2[3] * (n1[0] * v[12 * m] + n1[1] * v[13 * m] + n1[2] * v[14 * m] + \
               n1[3] * v[15 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER5(n1, n2, m, v)                      \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +            \
           n1[3] * v[3 * m] + n1[4] * v[4 * m]) +                          \
      n2[1] * (n1[0] * v[5 * m] + n1[1] * v[6 * m] + n1[2] * v[7 * m] +    \
               n1[3] * v[8 * m] + n1[4] * v[9 * m]) +                      \
      n2[2] * (n1[0] * v[10 * m] + n1[1] * v[11 * m] + n1[2] * v[12 * m] + \
               n1[3] * v[13 * m] + n1[4] * v[14 * m]) +                    \
      n2[3] * (n1[0] * v[15 * m] + n1[1] * v[16 * m] + n1[2] * v[17 * m] + \
               n1[3] * v[18 * m] + n1[4] * v[19 * m]) +                    \
      n2[4] * (n1[0] * v[20 * m] + n1[1] * v[21 * m] + n1[2] * v[22 * m] + \
               n1[3] * v[23 * m] + n1[4] * v[24 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER6(n1, n2, m, v)                       \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +             \
           n1[3] * v[3 * m] + n1[4] * v[4 * m] + n1[5] * v[5 * m]) +        \
      n2[1] * (n1[0] * v[6 * m] + n1[1] * v[7 * m] + n1[2] * v[8 * m] +     \
               n1[3] * v[9 * m] + n1[4] * v[10 * m] + n1[5] * v[11 * m]) +  \
      n2[2] * (n1[0] * v[12 * m] + n1[1] * v[13 * m] + n1[2] * v[14 * m] +  \
               n1[3] * v[15 * m] + n1[4] * v[16 * m] + n1[5] * v[17 * m]) + \
      n2[3] * (n1[0] * v[18 * m] + n1[1] * v[19 * m] + n1[2] * v[20 * m] +  \
               n1[3] * v[21 * m] + n1[4] * v[22 * m] + n1[5] * v[23 * m]) + \
      n2[4] * (n1[0] * v[24 * m] + n1[1] * v[25 * m] + n1[2] * v[26 * m] +  \
               n1[3] * v[27 * m] + n1[4] * v[28 * m] + n1[5] * v[29 * m]) + \
      n2[5] * (n1[0] * v[30 * m] + n1[1] * v[31 * m] + n1[2] * v[32 * m] +  \
               n1[3] * v[33 * m] + n1[4] * v[34 * m] + n1[5] * v[35 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER7(n1, n2, m, v)                      \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +            \
           n1[3] * v[3 * m] + n1[4] * v[4 * m] + n1[5] * v[5 * m] +        \
           n1[6] * v[6 * m]) +                                             \
      n2[1] * (n1[0] * v[7 * m] + n1[1] * v[8 * m] + n1[2] * v[9 * m] +    \
               n1[3] * v[10 * m] + n1[4] * v[11 * m] + n1[5] * v[12 * m] + \
               n1[6] * v[13 * m]) +                                        \
      n2[2] * (n1[0] * v[14 * m] + n1[1] * v[15 * m] + n1[2] * v[16 * m] + \
               n1[3] * v[17 * m] + n1[4] * v[18 * m] + n1[5] * v[19 * m] + \
               n1[6] * v[20 * m]) +                                        \
      n2[3] * (n1[0] * v[21 * m] + n1[1] * v[22 * m] + n1[2] * v[23 * m] + \
               n1[3] * v[24 * m] + n1[4] * v[25 * m] + n1[5] * v[26 * m] + \
               n1[6] * v[27 * m]) +                                        \
      n2[4] * (n1[0] * v[28 * m] + n1[1] * v[29 * m] + n1[2] * v[30 * m] + \
               n1[3] * v[31 * m] + n1[4] * v[32 * m] + n1[5] * v[33 * m] + \
               n1[6] * v[34 * m]) +                                        \
      n2[5] * (n1[0] * v[35 * m] + n1[1] * v[36 * m] + n1[2] * v[37 * m] + \
               n1[3] * v[38 * m] + n1[4] * v[39 * m] + n1[5] * v[40 * m] + \
               n1[6] * v[41 * m]) +                                        \
      n2[6] * (n1[0] * v[42 * m] + n1[1] * v[43 * m] + n1[2] * v[44 * m] + \
               n1[3] * v[45 * m] + n1[4] * v[46 * m] + n1[5] * v[47 * m] + \
               n1[6] * v[48 * m])

#define TACS_BASIS_EVAL_TENSOR2D_ORDER8(n1, n2, m, v)                      \
  n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +            \
           n1[3] * v[3 * m] + n1[4] * v[4 * m] + n1[5] * v[5 * m] +        \
           n1[6] * v[6 * m] + n1[7] * v[7 * m]) +                          \
      n2[1] * (n1[0] * v[8 * m] + n1[1] * v[9 * m] + n1[2] * v[10 * m] +   \
               n1[3] * v[11 * m] + n1[4] * v[12 * m] + n1[5] * v[13 * m] + \
               n1[6] * v[14 * m] + n1[7] * v[15 * m]) +                    \
      n2[2] * (n1[0] * v[16 * m] + n1[1] * v[17 * m] + n1[2] * v[18 * m] + \
               n1[3] * v[19 * m] + n1[4] * v[20 * m] + n1[5] * v[21 * m] + \
               n1[6] * v[22 * m] + n1[7] * v[23 * m]) +                    \
      n2[3] * (n1[0] * v[24 * m] + n1[1] * v[25 * m] + n1[2] * v[26 * m] + \
               n1[3] * v[27 * m] + n1[4] * v[28 * m] + n1[5] * v[29 * m] + \
               n1[6] * v[30 * m] + n1[7] * v[31 * m]) +                    \
      n2[4] * (n1[0] * v[32 * m] + n1[1] * v[33 * m] + n1[2] * v[34 * m] + \
               n1[3] * v[35 * m] + n1[4] * v[36 * m] + n1[5] * v[37 * m] + \
               n1[6] * v[38 * m] + n1[7] * v[39 * m]) +                    \
      n2[5] * (n1[0] * v[40 * m] + n1[1] * v[41 * m] + n1[2] * v[42 * m] + \
               n1[3] * v[43 * m] + n1[4] * v[44 * m] + n1[5] * v[45 * m] + \
               n1[6] * v[46 * m] + n1[7] * v[47 * m]) +                    \
      n2[6] * (n1[0] * v[48 * m] + n1[1] * v[49 * m] + n1[2] * v[50 * m] + \
               n1[3] * v[51 * m] + n1[4] * v[52 * m] + n1[5] * v[53 * m] + \
               n1[6] * v[54 * m] + n1[7] * v[55 * m]) +                    \
      n2[7] * (n1[0] * v[56 * m] + n1[1] * v[57 * m] + n1[2] * v[58 * m] + \
               n1[3] * v[59 * m] + n1[4] * v[60 * m] + n1[5] * v[61 * m] + \
               n1[6] * v[62 * m] + n1[7] * v[63 * m])

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER2(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  t = n2[1] * s;                                                 \
  v[2 * m] += n1[0] * t;                                         \
  v[3 * m] += n1[1] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER3(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  t = n2[1] * s;                                                 \
  v[3 * m] += n1[0] * t;                                         \
  v[4 * m] += n1[1] * t;                                         \
  v[5 * m] += n1[2] * t;                                         \
  t = n2[2] * s;                                                 \
  v[6 * m] += n1[0] * t;                                         \
  v[7 * m] += n1[1] * t;                                         \
  v[8 * m] += n1[2] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER4(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  v[3 * m] += n1[3] * t;                                         \
  t = n2[1] * s;                                                 \
  v[4 * m] += n1[0] * t;                                         \
  v[5 * m] += n1[1] * t;                                         \
  v[6 * m] += n1[2] * t;                                         \
  v[7 * m] += n1[3] * t;                                         \
  t = n2[2] * s;                                                 \
  v[8 * m] += n1[0] * t;                                         \
  v[9 * m] += n1[1] * t;                                         \
  v[10 * m] += n1[2] * t;                                        \
  v[11 * m] += n1[3] * t;                                        \
  t = n2[3] * s;                                                 \
  v[12 * m] += n1[0] * t;                                        \
  v[13 * m] += n1[1] * t;                                        \
  v[14 * m] += n1[2] * t;                                        \
  v[15 * m] += n1[3] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER5(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  v[3 * m] += n1[3] * t;                                         \
  v[4 * m] += n1[4] * t;                                         \
  t = n2[1] * s;                                                 \
  v[5 * m] += n1[0] * t;                                         \
  v[6 * m] += n1[1] * t;                                         \
  v[7 * m] += n1[2] * t;                                         \
  v[8 * m] += n1[3] * t;                                         \
  v[9 * m] += n1[4] * t;                                         \
  t = n2[2] * s;                                                 \
  v[10 * m] += n1[0] * t;                                        \
  v[11 * m] += n1[1] * t;                                        \
  v[12 * m] += n1[2] * t;                                        \
  v[13 * m] += n1[3] * t;                                        \
  v[14 * m] += n1[4] * t;                                        \
  t = n2[3] * s;                                                 \
  v[15 * m] += n1[0] * t;                                        \
  v[16 * m] += n1[1] * t;                                        \
  v[17 * m] += n1[2] * t;                                        \
  v[18 * m] += n1[3] * t;                                        \
  v[19 * m] += n1[4] * t;                                        \
  t = n2[4] * s;                                                 \
  v[20 * m] += n1[0] * t;                                        \
  v[21 * m] += n1[1] * t;                                        \
  v[22 * m] += n1[2] * t;                                        \
  v[23 * m] += n1[3] * t;                                        \
  v[24 * m] += n1[4] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER6(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  v[3 * m] += n1[3] * t;                                         \
  v[4 * m] += n1[4] * t;                                         \
  v[5 * m] += n1[5] * t;                                         \
  t = n2[1] * s;                                                 \
  v[6 * m] += n1[0] * t;                                         \
  v[7 * m] += n1[1] * t;                                         \
  v[8 * m] += n1[2] * t;                                         \
  v[9 * m] += n1[3] * t;                                         \
  v[10 * m] += n1[4] * t;                                        \
  v[11 * m] += n1[5] * t;                                        \
  t = n2[2] * s;                                                 \
  v[12 * m] += n1[0] * t;                                        \
  v[13 * m] += n1[1] * t;                                        \
  v[14 * m] += n1[2] * t;                                        \
  v[15 * m] += n1[3] * t;                                        \
  v[16 * m] += n1[4] * t;                                        \
  v[17 * m] += n1[5] * t;                                        \
  t = n2[3] * s;                                                 \
  v[18 * m] += n1[0] * t;                                        \
  v[19 * m] += n1[1] * t;                                        \
  v[20 * m] += n1[2] * t;                                        \
  v[21 * m] += n1[3] * t;                                        \
  v[22 * m] += n1[4] * t;                                        \
  v[23 * m] += n1[5] * t;                                        \
  t = n2[4] * s;                                                 \
  v[24 * m] += n1[0] * t;                                        \
  v[25 * m] += n1[1] * t;                                        \
  v[26 * m] += n1[2] * t;                                        \
  v[27 * m] += n1[3] * t;                                        \
  v[28 * m] += n1[4] * t;                                        \
  v[29 * m] += n1[5] * t;                                        \
  t = n2[5] * s;                                                 \
  v[30 * m] += n1[0] * t;                                        \
  v[31 * m] += n1[1] * t;                                        \
  v[32 * m] += n1[2] * t;                                        \
  v[33 * m] += n1[3] * t;                                        \
  v[34 * m] += n1[4] * t;                                        \
  v[35 * m] += n1[5] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER7(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  v[3 * m] += n1[3] * t;                                         \
  v[4 * m] += n1[4] * t;                                         \
  v[5 * m] += n1[5] * t;                                         \
  v[6 * m] += n1[6] * t;                                         \
  t = n2[1] * s;                                                 \
  v[7 * m] += n1[0] * t;                                         \
  v[8 * m] += n1[1] * t;                                         \
  v[9 * m] += n1[2] * t;                                         \
  v[10 * m] += n1[3] * t;                                        \
  v[11 * m] += n1[4] * t;                                        \
  v[12 * m] += n1[5] * t;                                        \
  v[13 * m] += n1[6] * t;                                        \
  t = n2[2] * s;                                                 \
  v[14 * m] += n1[0] * t;                                        \
  v[15 * m] += n1[1] * t;                                        \
  v[16 * m] += n1[2] * t;                                        \
  v[17 * m] += n1[3] * t;                                        \
  v[18 * m] += n1[4] * t;                                        \
  v[19 * m] += n1[5] * t;                                        \
  v[20 * m] += n1[6] * t;                                        \
  t = n2[3] * s;                                                 \
  v[21 * m] += n1[0] * t;                                        \
  v[22 * m] += n1[1] * t;                                        \
  v[23 * m] += n1[2] * t;                                        \
  v[24 * m] += n1[3] * t;                                        \
  v[25 * m] += n1[4] * t;                                        \
  v[26 * m] += n1[5] * t;                                        \
  v[27 * m] += n1[6] * t;                                        \
  t = n2[4] * s;                                                 \
  v[28 * m] += n1[0] * t;                                        \
  v[29 * m] += n1[1] * t;                                        \
  v[30 * m] += n1[2] * t;                                        \
  v[31 * m] += n1[3] * t;                                        \
  v[32 * m] += n1[4] * t;                                        \
  v[33 * m] += n1[5] * t;                                        \
  v[34 * m] += n1[6] * t;                                        \
  t = n2[5] * s;                                                 \
  v[35 * m] += n1[0] * t;                                        \
  v[36 * m] += n1[1] * t;                                        \
  v[37 * m] += n1[2] * t;                                        \
  v[38 * m] += n1[3] * t;                                        \
  v[39 * m] += n1[4] * t;                                        \
  v[40 * m] += n1[5] * t;                                        \
  v[41 * m] += n1[6] * t;                                        \
  t = n2[6] * s;                                                 \
  v[42 * m] += n1[0] * t;                                        \
  v[43 * m] += n1[1] * t;                                        \
  v[44 * m] += n1[2] * t;                                        \
  v[45 * m] += n1[3] * t;                                        \
  v[46 * m] += n1[4] * t;                                        \
  v[47 * m] += n1[5] * t;                                        \
  v[48 * m] += n1[6] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR2D_ORDER8(n1, n2, s, t, m, v) \
  t = n2[0] * s;                                                 \
  v[0] += n1[0] * t;                                             \
  v[1 * m] += n1[1] * t;                                         \
  v[2 * m] += n1[2] * t;                                         \
  v[3 * m] += n1[3] * t;                                         \
  v[4 * m] += n1[4] * t;                                         \
  v[5 * m] += n1[5] * t;                                         \
  v[6 * m] += n1[6] * t;                                         \
  v[7 * m] += n1[7] * t;                                         \
  t = n2[1] * s;                                                 \
  v[8 * m] += n1[0] * t;                                         \
  v[9 * m] += n1[1] * t;                                         \
  v[10 * m] += n1[2] * t;                                        \
  v[11 * m] += n1[3] * t;                                        \
  v[12 * m] += n1[4] * t;                                        \
  v[13 * m] += n1[5] * t;                                        \
  v[14 * m] += n1[6] * t;                                        \
  v[15 * m] += n1[7] * t;                                        \
  t = n2[2] * s;                                                 \
  v[16 * m] += n1[0] * t;                                        \
  v[17 * m] += n1[1] * t;                                        \
  v[18 * m] += n1[2] * t;                                        \
  v[19 * m] += n1[3] * t;                                        \
  v[20 * m] += n1[4] * t;                                        \
  v[21 * m] += n1[5] * t;                                        \
  v[22 * m] += n1[6] * t;                                        \
  v[23 * m] += n1[7] * t;                                        \
  t = n2[3] * s;                                                 \
  v[24 * m] += n1[0] * t;                                        \
  v[25 * m] += n1[1] * t;                                        \
  v[26 * m] += n1[2] * t;                                        \
  v[27 * m] += n1[3] * t;                                        \
  v[28 * m] += n1[4] * t;                                        \
  v[29 * m] += n1[5] * t;                                        \
  v[30 * m] += n1[6] * t;                                        \
  v[31 * m] += n1[7] * t;                                        \
  t = n2[4] * s;                                                 \
  v[32 * m] += n1[0] * t;                                        \
  v[33 * m] += n1[1] * t;                                        \
  v[34 * m] += n1[2] * t;                                        \
  v[35 * m] += n1[3] * t;                                        \
  v[36 * m] += n1[4] * t;                                        \
  v[37 * m] += n1[5] * t;                                        \
  v[38 * m] += n1[6] * t;                                        \
  v[39 * m] += n1[7] * t;                                        \
  t = n2[5] * s;                                                 \
  v[40 * m] += n1[0] * t;                                        \
  v[41 * m] += n1[1] * t;                                        \
  v[42 * m] += n1[2] * t;                                        \
  v[43 * m] += n1[3] * t;                                        \
  v[44 * m] += n1[4] * t;                                        \
  v[45 * m] += n1[5] * t;                                        \
  v[46 * m] += n1[6] * t;                                        \
  v[47 * m] += n1[7] * t;                                        \
  t = n2[6] * s;                                                 \
  v[48 * m] += n1[0] * t;                                        \
  v[49 * m] += n1[1] * t;                                        \
  v[50 * m] += n1[2] * t;                                        \
  v[51 * m] += n1[3] * t;                                        \
  v[52 * m] += n1[4] * t;                                        \
  v[53 * m] += n1[5] * t;                                        \
  v[54 * m] += n1[6] * t;                                        \
  v[55 * m] += n1[7] * t;                                        \
  t = n2[7] * s;                                                 \
  v[56 * m] += n1[0] * t;                                        \
  v[57 * m] += n1[1] * t;                                        \
  v[58 * m] += n1[2] * t;                                        \
  v[59 * m] += n1[3] * t;                                        \
  v[60 * m] += n1[4] * t;                                        \
  v[61 * m] += n1[5] * t;                                        \
  v[62 * m] += n1[6] * t;                                        \
  v[63 * m] += n1[7] * t;

#define TACS_BASIS_EVAL_TENSOR3D_ORDER2(n1, n2, n3, m, v)      \
  n3[0] * (n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m]) +         \
           n2[1] * (n1[0] * v[2 * m] + n1[1] * v[3 * m])) +    \
      n3[1] * (n2[0] * (n1[0] * v[4 * m] + n1[1] * v[5 * m]) + \
               n2[1] * (n1[0] * v[6 * m] + n1[1] * v[7 * m]))

#define TACS_BASIS_EVAL_TENSOR3D_ORDER3(n1, n2, n3, m, v)                      \
  n3[0] * (n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m]) +      \
           n2[1] * (n1[0] * v[3 * m] + n1[1] * v[4 * m] + n1[2] * v[5 * m]) +  \
           n2[2] * (n1[0] * v[6 * m] + n1[1] * v[7 * m] + n1[2] * v[8 * m])) + \
      n3[1] *                                                                  \
          (n2[0] *                                                             \
               (n1[0] * v[9 * m] + n1[1] * v[10 * m] + n1[2] * v[11 * m]) +    \
           n2[1] *                                                             \
               (n1[0] * v[12 * m] + n1[1] * v[13 * m] + n1[2] * v[14 * m]) +   \
           n2[2] *                                                             \
               (n1[0] * v[15 * m] + n1[1] * v[16 * m] + n1[2] * v[17 * m])) +  \
      n3[2] *                                                                  \
          (n2[0] *                                                             \
               (n1[0] * v[18 * m] + n1[1] * v[19 * m] + n1[2] * v[20 * m]) +   \
           n2[1] *                                                             \
               (n1[0] * v[21 * m] + n1[1] * v[22 * m] + n1[2] * v[23 * m]) +   \
           n2[2] *                                                             \
               (n1[0] * v[24 * m] + n1[1] * v[25 * m] + n1[2] * v[26 * m]))

#define TACS_BASIS_EVAL_TENSOR3D_ORDER4(n1, n2, n3, m, v)                     \
  n3[0] * (n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +      \
                    n1[3] * v[3 * m]) +                                       \
           n2[1] * (n1[0] * v[4 * m] + n1[1] * v[5 * m] + n1[2] * v[6 * m] +  \
                    n1[3] * v[7 * m]) +                                       \
           n2[2] * (n1[0] * v[8 * m] + n1[1] * v[9 * m] + n1[2] * v[10 * m] + \
                    n1[3] * v[11 * m]) +                                      \
           n2[3] * (n1[0] * v[12 * m] + n1[1] * v[13 * m] +                   \
                    n1[2] * v[14 * m] + n1[3] * v[15 * m])) +                 \
      n3[1] * (n2[0] * (n1[0] * v[16 * m] + n1[1] * v[17 * m] +               \
                        n1[2] * v[18 * m] + n1[3] * v[19 * m]) +              \
               n2[1] * (n1[0] * v[20 * m] + n1[1] * v[21 * m] +               \
                        n1[2] * v[22 * m] + n1[3] * v[23 * m]) +              \
               n2[2] * (n1[0] * v[24 * m] + n1[1] * v[25 * m] +               \
                        n1[2] * v[26 * m] + n1[3] * v[27 * m]) +              \
               n2[3] * (n1[0] * v[28 * m] + n1[1] * v[29 * m] +               \
                        n1[2] * v[30 * m] + n1[3] * v[31 * m])) +             \
      n3[2] * (n2[0] * (n1[0] * v[32 * m] + n1[1] * v[33 * m] +               \
                        n1[2] * v[34 * m] + n1[3] * v[35 * m]) +              \
               n2[1] * (n1[0] * v[36 * m] + n1[1] * v[37 * m] +               \
                        n1[2] * v[38 * m] + n1[3] * v[39 * m]) +              \
               n2[2] * (n1[0] * v[40 * m] + n1[1] * v[41 * m] +               \
                        n1[2] * v[42 * m] + n1[3] * v[43 * m]) +              \
               n2[3] * (n1[0] * v[44 * m] + n1[1] * v[45 * m] +               \
                        n1[2] * v[46 * m] + n1[3] * v[47 * m])) +             \
      n3[3] * (n2[0] * (n1[0] * v[48 * m] + n1[1] * v[49 * m] +               \
                        n1[2] * v[50 * m] + n1[3] * v[51 * m]) +              \
               n2[1] * (n1[0] * v[52 * m] + n1[1] * v[53 * m] +               \
                        n1[2] * v[54 * m] + n1[3] * v[55 * m]) +              \
               n2[2] * (n1[0] * v[56 * m] + n1[1] * v[57 * m] +               \
                        n1[2] * v[58 * m] + n1[3] * v[59 * m]) +              \
               n2[3] * (n1[0] * v[60 * m] + n1[1] * v[61 * m] +               \
                        n1[2] * v[62 * m] + n1[3] * v[63 * m]))

#define TACS_BASIS_EVAL_TENSOR3D_ORDER5(n1, n2, n3, m, v)                    \
  n3[0] * (n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +     \
                    n1[3] * v[3 * m] + n1[4] * v[4 * m]) +                   \
           n2[1] * (n1[0] * v[5 * m] + n1[1] * v[6 * m] + n1[2] * v[7 * m] + \
                    n1[3] * v[8 * m] + n1[4] * v[9 * m]) +                   \
           n2[2] *                                                           \
               (n1[0] * v[10 * m] + n1[1] * v[11 * m] + n1[2] * v[12 * m] +  \
                n1[3] * v[13 * m] + n1[4] * v[14 * m]) +                     \
           n2[3] *                                                           \
               (n1[0] * v[15 * m] + n1[1] * v[16 * m] + n1[2] * v[17 * m] +  \
                n1[3] * v[18 * m] + n1[4] * v[19 * m]) +                     \
           n2[4] *                                                           \
               (n1[0] * v[20 * m] + n1[1] * v[21 * m] + n1[2] * v[22 * m] +  \
                n1[3] * v[23 * m] + n1[4] * v[24 * m])) +                    \
      n3[1] * (n2[0] * (n1[0] * v[25 * m] + n1[1] * v[26 * m] +              \
                        n1[2] * v[27 * m] + n1[3] * v[28 * m] +              \
                        n1[4] * v[29 * m]) +                                 \
               n2[1] * (n1[0] * v[30 * m] + n1[1] * v[31 * m] +              \
                        n1[2] * v[32 * m] + n1[3] * v[33 * m] +              \
                        n1[4] * v[34 * m]) +                                 \
               n2[2] * (n1[0] * v[35 * m] + n1[1] * v[36 * m] +              \
                        n1[2] * v[37 * m] + n1[3] * v[38 * m] +              \
                        n1[4] * v[39 * m]) +                                 \
               n2[3] * (n1[0] * v[40 * m] + n1[1] * v[41 * m] +              \
                        n1[2] * v[42 * m] + n1[3] * v[43 * m] +              \
                        n1[4] * v[44 * m]) +                                 \
               n2[4] * (n1[0] * v[45 * m] + n1[1] * v[46 * m] +              \
                        n1[2] * v[47 * m] + n1[3] * v[48 * m] +              \
                        n1[4] * v[49 * m])) +                                \
      n3[2] * (n2[0] * (n1[0] * v[50 * m] + n1[1] * v[51 * m] +              \
                        n1[2] * v[52 * m] + n1[3] * v[53 * m] +              \
                        n1[4] * v[54 * m]) +                                 \
               n2[1] * (n1[0] * v[55 * m] + n1[1] * v[56 * m] +              \
                        n1[2] * v[57 * m] + n1[3] * v[58 * m] +              \
                        n1[4] * v[59 * m]) +                                 \
               n2[2] * (n1[0] * v[60 * m] + n1[1] * v[61 * m] +              \
                        n1[2] * v[62 * m] + n1[3] * v[63 * m] +              \
                        n1[4] * v[64 * m]) +                                 \
               n2[3] * (n1[0] * v[65 * m] + n1[1] * v[66 * m] +              \
                        n1[2] * v[67 * m] + n1[3] * v[68 * m] +              \
                        n1[4] * v[69 * m]) +                                 \
               n2[4] * (n1[0] * v[70 * m] + n1[1] * v[71 * m] +              \
                        n1[2] * v[72 * m] + n1[3] * v[73 * m] +              \
                        n1[4] * v[74 * m])) +                                \
      n3[3] * (n2[0] * (n1[0] * v[75 * m] + n1[1] * v[76 * m] +              \
                        n1[2] * v[77 * m] + n1[3] * v[78 * m] +              \
                        n1[4] * v[79 * m]) +                                 \
               n2[1] * (n1[0] * v[80 * m] + n1[1] * v[81 * m] +              \
                        n1[2] * v[82 * m] + n1[3] * v[83 * m] +              \
                        n1[4] * v[84 * m]) +                                 \
               n2[2] * (n1[0] * v[85 * m] + n1[1] * v[86 * m] +              \
                        n1[2] * v[87 * m] + n1[3] * v[88 * m] +              \
                        n1[4] * v[89 * m]) +                                 \
               n2[3] * (n1[0] * v[90 * m] + n1[1] * v[91 * m] +              \
                        n1[2] * v[92 * m] + n1[3] * v[93 * m] +              \
                        n1[4] * v[94 * m]) +                                 \
               n2[4] * (n1[0] * v[95 * m] + n1[1] * v[96 * m] +              \
                        n1[2] * v[97 * m] + n1[3] * v[98 * m] +              \
                        n1[4] * v[99 * m])) +                                \
      n3[4] * (n2[0] * (n1[0] * v[100 * m] + n1[1] * v[101 * m] +            \
                        n1[2] * v[102 * m] + n1[3] * v[103 * m] +            \
                        n1[4] * v[104 * m]) +                                \
               n2[1] * (n1[0] * v[105 * m] + n1[1] * v[106 * m] +            \
                        n1[2] * v[107 * m] + n1[3] * v[108 * m] +            \
                        n1[4] * v[109 * m]) +                                \
               n2[2] * (n1[0] * v[110 * m] + n1[1] * v[111 * m] +            \
                        n1[2] * v[112 * m] + n1[3] * v[113 * m] +            \
                        n1[4] * v[114 * m]) +                                \
               n2[3] * (n1[0] * v[115 * m] + n1[1] * v[116 * m] +            \
                        n1[2] * v[117 * m] + n1[3] * v[118 * m] +            \
                        n1[4] * v[119 * m]) +                                \
               n2[4] * (n1[0] * v[120 * m] + n1[1] * v[121 * m] +            \
                        n1[2] * v[122 * m] + n1[3] * v[123 * m] +            \
                        n1[4] * v[124 * m]))

#define TACS_BASIS_EVAL_TENSOR3D_ORDER6(n1, n2, n3, m, v)                     \
  n3[0] * (n2[0] * (n1[0] * v[0] + n1[1] * v[1 * m] + n1[2] * v[2 * m] +      \
                    n1[3] * v[3 * m] + n1[4] * v[4 * m] + n1[5] * v[5 * m]) + \
           n2[1] *                                                            \
               (n1[0] * v[6 * m] + n1[1] * v[7 * m] + n1[2] * v[8 * m] +      \
                n1[3] * v[9 * m] + n1[4] * v[10 * m] + n1[5] * v[11 * m]) +   \
           n2[2] *                                                            \
               (n1[0] * v[12 * m] + n1[1] * v[13 * m] + n1[2] * v[14 * m] +   \
                n1[3] * v[15 * m] + n1[4] * v[16 * m] + n1[5] * v[17 * m]) +  \
           n2[3] *                                                            \
               (n1[0] * v[18 * m] + n1[1] * v[19 * m] + n1[2] * v[20 * m] +   \
                n1[3] * v[21 * m] + n1[4] * v[22 * m] + n1[5] * v[23 * m]) +  \
           n2[4] *                                                            \
               (n1[0] * v[24 * m] + n1[1] * v[25 * m] + n1[2] * v[26 * m] +   \
                n1[3] * v[27 * m] + n1[4] * v[28 * m] + n1[5] * v[29 * m]) +  \
           n2[5] *                                                            \
               (n1[0] * v[30 * m] + n1[1] * v[31 * m] + n1[2] * v[32 * m] +   \
                n1[3] * v[33 * m] + n1[4] * v[34 * m] + n1[5] * v[35 * m])) + \
      n3[1] * (n2[0] * (n1[0] * v[36 * m] + n1[1] * v[37 * m] +               \
                        n1[2] * v[38 * m] + n1[3] * v[39 * m] +               \
                        n1[4] * v[40 * m] + n1[5] * v[41 * m]) +              \
               n2[1] * (n1[0] * v[42 * m] + n1[1] * v[43 * m] +               \
                        n1[2] * v[44 * m] + n1[3] * v[45 * m] +               \
                        n1[4] * v[46 * m] + n1[5] * v[47 * m]) +              \
               n2[2] * (n1[0] * v[48 * m] + n1[1] * v[49 * m] +               \
                        n1[2] * v[50 * m] + n1[3] * v[51 * m] +               \
                        n1[4] * v[52 * m] + n1[5] * v[53 * m]) +              \
               n2[3] * (n1[0] * v[54 * m] + n1[1] * v[55 * m] +               \
                        n1[2] * v[56 * m] + n1[3] * v[57 * m] +               \
                        n1[4] * v[58 * m] + n1[5] * v[59 * m]) +              \
               n2[4] * (n1[0] * v[60 * m] + n1[1] * v[61 * m] +               \
                        n1[2] * v[62 * m] + n1[3] * v[63 * m] +               \
                        n1[4] * v[64 * m] + n1[5] * v[65 * m]) +              \
               n2[5] * (n1[0] * v[66 * m] + n1[1] * v[67 * m] +               \
                        n1[2] * v[68 * m] + n1[3] * v[69 * m] +               \
                        n1[4] * v[70 * m] + n1[5] * v[71 * m])) +             \
      n3[2] * (n2[0] * (n1[0] * v[72 * m] + n1[1] * v[73 * m] +               \
                        n1[2] * v[74 * m] + n1[3] * v[75 * m] +               \
                        n1[4] * v[76 * m] + n1[5] * v[77 * m]) +              \
               n2[1] * (n1[0] * v[78 * m] + n1[1] * v[79 * m] +               \
                        n1[2] * v[80 * m] + n1[3] * v[81 * m] +               \
                        n1[4] * v[82 * m] + n1[5] * v[83 * m]) +              \
               n2[2] * (n1[0] * v[84 * m] + n1[1] * v[85 * m] +               \
                        n1[2] * v[86 * m] + n1[3] * v[87 * m] +               \
                        n1[4] * v[88 * m] + n1[5] * v[89 * m]) +              \
               n2[3] * (n1[0] * v[90 * m] + n1[1] * v[91 * m] +               \
                        n1[2] * v[92 * m] + n1[3] * v[93 * m] +               \
                        n1[4] * v[94 * m] + n1[5] * v[95 * m]) +              \
               n2[4] * (n1[0] * v[96 * m] + n1[1] * v[97 * m] +               \
                        n1[2] * v[98 * m] + n1[3] * v[99 * m] +               \
                        n1[4] * v[100 * m] + n1[5] * v[101 * m]) +            \
               n2[5] * (n1[0] * v[102 * m] + n1[1] * v[103 * m] +             \
                        n1[2] * v[104 * m] + n1[3] * v[105 * m] +             \
                        n1[4] * v[106 * m] + n1[5] * v[107 * m])) +           \
      n3[3] * (n2[0] * (n1[0] * v[108 * m] + n1[1] * v[109 * m] +             \
                        n1[2] * v[110 * m] + n1[3] * v[111 * m] +             \
                        n1[4] * v[112 * m] + n1[5] * v[113 * m]) +            \
               n2[1] * (n1[0] * v[114 * m] + n1[1] * v[115 * m] +             \
                        n1[2] * v[116 * m] + n1[3] * v[117 * m] +             \
                        n1[4] * v[118 * m] + n1[5] * v[119 * m]) +            \
               n2[2] * (n1[0] * v[120 * m] + n1[1] * v[121 * m] +             \
                        n1[2] * v[122 * m] + n1[3] * v[123 * m] +             \
                        n1[4] * v[124 * m] + n1[5] * v[125 * m]) +            \
               n2[3] * (n1[0] * v[126 * m] + n1[1] * v[127 * m] +             \
                        n1[2] * v[128 * m] + n1[3] * v[129 * m] +             \
                        n1[4] * v[130 * m] + n1[5] * v[131 * m]) +            \
               n2[4] * (n1[0] * v[132 * m] + n1[1] * v[133 * m] +             \
                        n1[2] * v[134 * m] + n1[3] * v[135 * m] +             \
                        n1[4] * v[136 * m] + n1[5] * v[137 * m]) +            \
               n2[5] * (n1[0] * v[138 * m] + n1[1] * v[139 * m] +             \
                        n1[2] * v[140 * m] + n1[3] * v[141 * m] +             \
                        n1[4] * v[142 * m] + n1[5] * v[143 * m])) +           \
      n3[4] * (n2[0] * (n1[0] * v[144 * m] + n1[1] * v[145 * m] +             \
                        n1[2] * v[146 * m] + n1[3] * v[147 * m] +             \
                        n1[4] * v[148 * m] + n1[5] * v[149 * m]) +            \
               n2[1] * (n1[0] * v[150 * m] + n1[1] * v[151 * m] +             \
                        n1[2] * v[152 * m] + n1[3] * v[153 * m] +             \
                        n1[4] * v[154 * m] + n1[5] * v[155 * m]) +            \
               n2[2] * (n1[0] * v[156 * m] + n1[1] * v[157 * m] +             \
                        n1[2] * v[158 * m] + n1[3] * v[159 * m] +             \
                        n1[4] * v[160 * m] + n1[5] * v[161 * m]) +            \
               n2[3] * (n1[0] * v[162 * m] + n1[1] * v[163 * m] +             \
                        n1[2] * v[164 * m] + n1[3] * v[165 * m] +             \
                        n1[4] * v[166 * m] + n1[5] * v[167 * m]) +            \
               n2[4] * (n1[0] * v[168 * m] + n1[1] * v[169 * m] +             \
                        n1[2] * v[170 * m] + n1[3] * v[171 * m] +             \
                        n1[4] * v[172 * m] + n1[5] * v[173 * m]) +            \
               n2[5] * (n1[0] * v[174 * m] + n1[1] * v[175 * m] +             \
                        n1[2] * v[176 * m] + n1[3] * v[177 * m] +             \
                        n1[4] * v[178 * m] + n1[5] * v[179 * m])) +           \
      n3[5] * (n2[0] * (n1[0] * v[180 * m] + n1[1] * v[181 * m] +             \
                        n1[2] * v[182 * m] + n1[3] * v[183 * m] +             \
                        n1[4] * v[184 * m] + n1[5] * v[185 * m]) +            \
               n2[1] * (n1[0] * v[186 * m] + n1[1] * v[187 * m] +             \
                        n1[2] * v[188 * m] + n1[3] * v[189 * m] +             \
                        n1[4] * v[190 * m] + n1[5] * v[191 * m]) +            \
               n2[2] * (n1[0] * v[192 * m] + n1[1] * v[193 * m] +             \
                        n1[2] * v[194 * m] + n1[3] * v[195 * m] +             \
                        n1[4] * v[196 * m] + n1[5] * v[197 * m]) +            \
               n2[3] * (n1[0] * v[198 * m] + n1[1] * v[199 * m] +             \
                        n1[2] * v[200 * m] + n1[3] * v[201 * m] +             \
                        n1[4] * v[202 * m] + n1[5] * v[203 * m]) +            \
               n2[4] * (n1[0] * v[204 * m] + n1[1] * v[205 * m] +             \
                        n1[2] * v[206 * m] + n1[3] * v[207 * m] +             \
                        n1[4] * v[208 * m] + n1[5] * v[209 * m]) +            \
               n2[5] * (n1[0] * v[210 * m] + n1[1] * v[211 * m] +             \
                        n1[2] * v[212 * m] + n1[3] * v[213 * m] +             \
                        n1[4] * v[214 * m] + n1[5] * v[215 * m]))

#define TACS_BASIS_TRANSPOSE_TENSOR3D_ORDER2(n1, n2, n3, s, t, m, v) \
  t = n2[0] * n3[0] * s;                                             \
  v[0] += n1[0] * t;                                                 \
  v[1 * m] += n1[1] * t;                                             \
  t = n2[1] * n3[0] * s;                                             \
  v[2 * m] += n1[0] * t;                                             \
  v[3 * m] += n1[1] * t;                                             \
  t = n2[0] * n3[1] * s;                                             \
  v[4 * m] += n1[0] * t;                                             \
  v[5 * m] += n1[1] * t;                                             \
  t = n2[1] * n3[1] * s;                                             \
  v[6 * m] += n1[0] * t;                                             \
  v[7 * m] += n1[1] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR3D_ORDER3(n1, n2, n3, s, t, m, v) \
  t = n2[0] * n3[0] * s;                                             \
  v[0] += n1[0] * t;                                                 \
  v[1 * m] += n1[1] * t;                                             \
  v[2 * m] += n1[2] * t;                                             \
  t = n2[1] * n3[0] * s;                                             \
  v[3 * m] += n1[0] * t;                                             \
  v[4 * m] += n1[1] * t;                                             \
  v[5 * m] += n1[2] * t;                                             \
  t = n2[2] * n3[0] * s;                                             \
  v[6 * m] += n1[0] * t;                                             \
  v[7 * m] += n1[1] * t;                                             \
  v[8 * m] += n1[2] * t;                                             \
  t = n2[0] * n3[1] * s;                                             \
  v[9 * m] += n1[0] * t;                                             \
  v[10 * m] += n1[1] * t;                                            \
  v[11 * m] += n1[2] * t;                                            \
  t = n2[1] * n3[1] * s;                                             \
  v[12 * m] += n1[0] * t;                                            \
  v[13 * m] += n1[1] * t;                                            \
  v[14 * m] += n1[2] * t;                                            \
  t = n2[2] * n3[1] * s;                                             \
  v[15 * m] += n1[0] * t;                                            \
  v[16 * m] += n1[1] * t;                                            \
  v[17 * m] += n1[2] * t;                                            \
  t = n2[0] * n3[2] * s;                                             \
  v[18 * m] += n1[0] * t;                                            \
  v[19 * m] += n1[1] * t;                                            \
  v[20 * m] += n1[2] * t;                                            \
  t = n2[1] * n3[2] * s;                                             \
  v[21 * m] += n1[0] * t;                                            \
  v[22 * m] += n1[1] * t;                                            \
  v[23 * m] += n1[2] * t;                                            \
  t = n2[2] * n3[2] * s;                                             \
  v[24 * m] += n1[0] * t;                                            \
  v[25 * m] += n1[1] * t;                                            \
  v[26 * m] += n1[2] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR3D_ORDER4(n1, n2, n3, s, t, m, v) \
  t = n2[0] * n3[0] * s;                                             \
  v[0] += n1[0] * t;                                                 \
  v[1 * m] += n1[1] * t;                                             \
  v[2 * m] += n1[2] * t;                                             \
  v[3 * m] += n1[3] * t;                                             \
  t = n2[1] * n3[0] * s;                                             \
  v[4 * m] += n1[0] * t;                                             \
  v[5 * m] += n1[1] * t;                                             \
  v[6 * m] += n1[2] * t;                                             \
  v[7 * m] += n1[3] * t;                                             \
  t = n2[2] * n3[0] * s;                                             \
  v[8 * m] += n1[0] * t;                                             \
  v[9 * m] += n1[1] * t;                                             \
  v[10 * m] += n1[2] * t;                                            \
  v[11 * m] += n1[3] * t;                                            \
  t = n2[3] * n3[0] * s;                                             \
  v[12 * m] += n1[0] * t;                                            \
  v[13 * m] += n1[1] * t;                                            \
  v[14 * m] += n1[2] * t;                                            \
  v[15 * m] += n1[3] * t;                                            \
  t = n2[0] * n3[1] * s;                                             \
  v[16 * m] += n1[0] * t;                                            \
  v[17 * m] += n1[1] * t;                                            \
  v[18 * m] += n1[2] * t;                                            \
  v[19 * m] += n1[3] * t;                                            \
  t = n2[1] * n3[1] * s;                                             \
  v[20 * m] += n1[0] * t;                                            \
  v[21 * m] += n1[1] * t;                                            \
  v[22 * m] += n1[2] * t;                                            \
  v[23 * m] += n1[3] * t;                                            \
  t = n2[2] * n3[1] * s;                                             \
  v[24 * m] += n1[0] * t;                                            \
  v[25 * m] += n1[1] * t;                                            \
  v[26 * m] += n1[2] * t;                                            \
  v[27 * m] += n1[3] * t;                                            \
  t = n2[3] * n3[1] * s;                                             \
  v[28 * m] += n1[0] * t;                                            \
  v[29 * m] += n1[1] * t;                                            \
  v[30 * m] += n1[2] * t;                                            \
  v[31 * m] += n1[3] * t;                                            \
  t = n2[0] * n3[2] * s;                                             \
  v[32 * m] += n1[0] * t;                                            \
  v[33 * m] += n1[1] * t;                                            \
  v[34 * m] += n1[2] * t;                                            \
  v[35 * m] += n1[3] * t;                                            \
  t = n2[1] * n3[2] * s;                                             \
  v[36 * m] += n1[0] * t;                                            \
  v[37 * m] += n1[1] * t;                                            \
  v[38 * m] += n1[2] * t;                                            \
  v[39 * m] += n1[3] * t;                                            \
  t = n2[2] * n3[2] * s;                                             \
  v[40 * m] += n1[0] * t;                                            \
  v[41 * m] += n1[1] * t;                                            \
  v[42 * m] += n1[2] * t;                                            \
  v[43 * m] += n1[3] * t;                                            \
  t = n2[3] * n3[2] * s;                                             \
  v[44 * m] += n1[0] * t;                                            \
  v[45 * m] += n1[1] * t;                                            \
  v[46 * m] += n1[2] * t;                                            \
  v[47 * m] += n1[3] * t;                                            \
  t = n2[0] * n3[3] * s;                                             \
  v[48 * m] += n1[0] * t;                                            \
  v[49 * m] += n1[1] * t;                                            \
  v[50 * m] += n1[2] * t;                                            \
  v[51 * m] += n1[3] * t;                                            \
  t = n2[1] * n3[3] * s;                                             \
  v[52 * m] += n1[0] * t;                                            \
  v[53 * m] += n1[1] * t;                                            \
  v[54 * m] += n1[2] * t;                                            \
  v[55 * m] += n1[3] * t;                                            \
  t = n2[2] * n3[3] * s;                                             \
  v[56 * m] += n1[0] * t;                                            \
  v[57 * m] += n1[1] * t;                                            \
  v[58 * m] += n1[2] * t;                                            \
  v[59 * m] += n1[3] * t;                                            \
  t = n2[3] * n3[3] * s;                                             \
  v[60 * m] += n1[0] * t;                                            \
  v[61 * m] += n1[1] * t;                                            \
  v[62 * m] += n1[2] * t;                                            \
  v[63 * m] += n1[3] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR3D_ORDER5(n1, n2, n3, s, t, m, v) \
  t = n2[0] * n3[0] * s;                                             \
  v[0] += n1[0] * t;                                                 \
  v[1 * m] += n1[1] * t;                                             \
  v[2 * m] += n1[2] * t;                                             \
  v[3 * m] += n1[3] * t;                                             \
  v[4 * m] += n1[4] * t;                                             \
  t = n2[1] * n3[0] * s;                                             \
  v[5 * m] += n1[0] * t;                                             \
  v[6 * m] += n1[1] * t;                                             \
  v[7 * m] += n1[2] * t;                                             \
  v[8 * m] += n1[3] * t;                                             \
  v[9 * m] += n1[4] * t;                                             \
  t = n2[2] * n3[0] * s;                                             \
  v[10 * m] += n1[0] * t;                                            \
  v[11 * m] += n1[1] * t;                                            \
  v[12 * m] += n1[2] * t;                                            \
  v[13 * m] += n1[3] * t;                                            \
  v[14 * m] += n1[4] * t;                                            \
  t = n2[3] * n3[0] * s;                                             \
  v[15 * m] += n1[0] * t;                                            \
  v[16 * m] += n1[1] * t;                                            \
  v[17 * m] += n1[2] * t;                                            \
  v[18 * m] += n1[3] * t;                                            \
  v[19 * m] += n1[4] * t;                                            \
  t = n2[4] * n3[0] * s;                                             \
  v[20 * m] += n1[0] * t;                                            \
  v[21 * m] += n1[1] * t;                                            \
  v[22 * m] += n1[2] * t;                                            \
  v[23 * m] += n1[3] * t;                                            \
  v[24 * m] += n1[4] * t;                                            \
  t = n2[0] * n3[1] * s;                                             \
  v[25 * m] += n1[0] * t;                                            \
  v[26 * m] += n1[1] * t;                                            \
  v[27 * m] += n1[2] * t;                                            \
  v[28 * m] += n1[3] * t;                                            \
  v[29 * m] += n1[4] * t;                                            \
  t = n2[1] * n3[1] * s;                                             \
  v[30 * m] += n1[0] * t;                                            \
  v[31 * m] += n1[1] * t;                                            \
  v[32 * m] += n1[2] * t;                                            \
  v[33 * m] += n1[3] * t;                                            \
  v[34 * m] += n1[4] * t;                                            \
  t = n2[2] * n3[1] * s;                                             \
  v[35 * m] += n1[0] * t;                                            \
  v[36 * m] += n1[1] * t;                                            \
  v[37 * m] += n1[2] * t;                                            \
  v[38 * m] += n1[3] * t;                                            \
  v[39 * m] += n1[4] * t;                                            \
  t = n2[3] * n3[1] * s;                                             \
  v[40 * m] += n1[0] * t;                                            \
  v[41 * m] += n1[1] * t;                                            \
  v[42 * m] += n1[2] * t;                                            \
  v[43 * m] += n1[3] * t;                                            \
  v[44 * m] += n1[4] * t;                                            \
  t = n2[4] * n3[1] * s;                                             \
  v[45 * m] += n1[0] * t;                                            \
  v[46 * m] += n1[1] * t;                                            \
  v[47 * m] += n1[2] * t;                                            \
  v[48 * m] += n1[3] * t;                                            \
  v[49 * m] += n1[4] * t;                                            \
  t = n2[0] * n3[2] * s;                                             \
  v[50 * m] += n1[0] * t;                                            \
  v[51 * m] += n1[1] * t;                                            \
  v[52 * m] += n1[2] * t;                                            \
  v[53 * m] += n1[3] * t;                                            \
  v[54 * m] += n1[4] * t;                                            \
  t = n2[1] * n3[2] * s;                                             \
  v[55 * m] += n1[0] * t;                                            \
  v[56 * m] += n1[1] * t;                                            \
  v[57 * m] += n1[2] * t;                                            \
  v[58 * m] += n1[3] * t;                                            \
  v[59 * m] += n1[4] * t;                                            \
  t = n2[2] * n3[2] * s;                                             \
  v[60 * m] += n1[0] * t;                                            \
  v[61 * m] += n1[1] * t;                                            \
  v[62 * m] += n1[2] * t;                                            \
  v[63 * m] += n1[3] * t;                                            \
  v[64 * m] += n1[4] * t;                                            \
  t = n2[3] * n3[2] * s;                                             \
  v[65 * m] += n1[0] * t;                                            \
  v[66 * m] += n1[1] * t;                                            \
  v[67 * m] += n1[2] * t;                                            \
  v[68 * m] += n1[3] * t;                                            \
  v[69 * m] += n1[4] * t;                                            \
  t = n2[4] * n3[2] * s;                                             \
  v[70 * m] += n1[0] * t;                                            \
  v[71 * m] += n1[1] * t;                                            \
  v[72 * m] += n1[2] * t;                                            \
  v[73 * m] += n1[3] * t;                                            \
  v[74 * m] += n1[4] * t;                                            \
  t = n2[0] * n3[3] * s;                                             \
  v[75 * m] += n1[0] * t;                                            \
  v[76 * m] += n1[1] * t;                                            \
  v[77 * m] += n1[2] * t;                                            \
  v[78 * m] += n1[3] * t;                                            \
  v[79 * m] += n1[4] * t;                                            \
  t = n2[1] * n3[3] * s;                                             \
  v[80 * m] += n1[0] * t;                                            \
  v[81 * m] += n1[1] * t;                                            \
  v[82 * m] += n1[2] * t;                                            \
  v[83 * m] += n1[3] * t;                                            \
  v[84 * m] += n1[4] * t;                                            \
  t = n2[2] * n3[3] * s;                                             \
  v[85 * m] += n1[0] * t;                                            \
  v[86 * m] += n1[1] * t;                                            \
  v[87 * m] += n1[2] * t;                                            \
  v[88 * m] += n1[3] * t;                                            \
  v[89 * m] += n1[4] * t;                                            \
  t = n2[3] * n3[3] * s;                                             \
  v[90 * m] += n1[0] * t;                                            \
  v[91 * m] += n1[1] * t;                                            \
  v[92 * m] += n1[2] * t;                                            \
  v[93 * m] += n1[3] * t;                                            \
  v[94 * m] += n1[4] * t;                                            \
  t = n2[4] * n3[3] * s;                                             \
  v[95 * m] += n1[0] * t;                                            \
  v[96 * m] += n1[1] * t;                                            \
  v[97 * m] += n1[2] * t;                                            \
  v[98 * m] += n1[3] * t;                                            \
  v[99 * m] += n1[4] * t;                                            \
  t = n2[0] * n3[4] * s;                                             \
  v[100 * m] += n1[0] * t;                                           \
  v[101 * m] += n1[1] * t;                                           \
  v[102 * m] += n1[2] * t;                                           \
  v[103 * m] += n1[3] * t;                                           \
  v[104 * m] += n1[4] * t;                                           \
  t = n2[1] * n3[4] * s;                                             \
  v[105 * m] += n1[0] * t;                                           \
  v[106 * m] += n1[1] * t;                                           \
  v[107 * m] += n1[2] * t;                                           \
  v[108 * m] += n1[3] * t;                                           \
  v[109 * m] += n1[4] * t;                                           \
  t = n2[2] * n3[4] * s;                                             \
  v[110 * m] += n1[0] * t;                                           \
  v[111 * m] += n1[1] * t;                                           \
  v[112 * m] += n1[2] * t;                                           \
  v[113 * m] += n1[3] * t;                                           \
  v[114 * m] += n1[4] * t;                                           \
  t = n2[3] * n3[4] * s;                                             \
  v[115 * m] += n1[0] * t;                                           \
  v[116 * m] += n1[1] * t;                                           \
  v[117 * m] += n1[2] * t;                                           \
  v[118 * m] += n1[3] * t;                                           \
  v[119 * m] += n1[4] * t;                                           \
  t = n2[4] * n3[4] * s;                                             \
  v[120 * m] += n1[0] * t;                                           \
  v[121 * m] += n1[1] * t;                                           \
  v[122 * m] += n1[2] * t;                                           \
  v[123 * m] += n1[3] * t;                                           \
  v[124 * m] += n1[4] * t;

#define TACS_BASIS_TRANSPOSE_TENSOR3D_ORDER6(n1, n2, n3, s, t, m, v) \
  t = n2[0] * n3[0] * s;                                             \
  v[0] += n1[0] * t;                                                 \
  v[1 * m] += n1[1] * t;                                             \
  v[2 * m] += n1[2] * t;                                             \
  v[3 * m] += n1[3] * t;                                             \
  v[4 * m] += n1[4] * t;                                             \
  v[5 * m] += n1[5] * t;                                             \
  t = n2[1] * n3[0] * s;                                             \
  v[6 * m] += n1[0] * t;                                             \
  v[7 * m] += n1[1] * t;                                             \
  v[8 * m] += n1[2] * t;                                             \
  v[9 * m] += n1[3] * t;                                             \
  v[10 * m] += n1[4] * t;                                            \
  v[11 * m] += n1[5] * t;                                            \
  t = n2[2] * n3[0] * s;                                             \
  v[12 * m] += n1[0] * t;                                            \
  v[13 * m] += n1[1] * t;                                            \
  v[14 * m] += n1[2] * t;                                            \
  v[15 * m] += n1[3] * t;                                            \
  v[16 * m] += n1[4] * t;                                            \
  v[17 * m] += n1[5] * t;                                            \
  t = n2[3] * n3[0] * s;                                             \
  v[18 * m] += n1[0] * t;                                            \
  v[19 * m] += n1[1] * t;                                            \
  v[20 * m] += n1[2] * t;                                            \
  v[21 * m] += n1[3] * t;                                            \
  v[22 * m] += n1[4] * t;                                            \
  v[23 * m] += n1[5] * t;                                            \
  t = n2[4] * n3[0] * s;                                             \
  v[24 * m] += n1[0] * t;                                            \
  v[25 * m] += n1[1] * t;                                            \
  v[26 * m] += n1[2] * t;                                            \
  v[27 * m] += n1[3] * t;                                            \
  v[28 * m] += n1[4] * t;                                            \
  v[29 * m] += n1[5] * t;                                            \
  t = n2[5] * n3[0] * s;                                             \
  v[30 * m] += n1[0] * t;                                            \
  v[31 * m] += n1[1] * t;                                            \
  v[32 * m] += n1[2] * t;                                            \
  v[33 * m] += n1[3] * t;                                            \
  v[34 * m] += n1[4] * t;                                            \
  v[35 * m] += n1[5] * t;                                            \
  t = n2[0] * n3[1] * s;                                             \
  v[36 * m] += n1[0] * t;                                            \
  v[37 * m] += n1[1] * t;                                            \
  v[38 * m] += n1[2] * t;                                            \
  v[39 * m] += n1[3] * t;                                            \
  v[40 * m] += n1[4] * t;                                            \
  v[41 * m] += n1[5] * t;                                            \
  t = n2[1] * n3[1] * s;                                             \
  v[42 * m] += n1[0] * t;                                            \
  v[43 * m] += n1[1] * t;                                            \
  v[44 * m] += n1[2] * t;                                            \
  v[45 * m] += n1[3] * t;                                            \
  v[46 * m] += n1[4] * t;                                            \
  v[47 * m] += n1[5] * t;                                            \
  t = n2[2] * n3[1] * s;                                             \
  v[48 * m] += n1[0] * t;                                            \
  v[49 * m] += n1[1] * t;                                            \
  v[50 * m] += n1[2] * t;                                            \
  v[51 * m] += n1[3] * t;                                            \
  v[52 * m] += n1[4] * t;                                            \
  v[53 * m] += n1[5] * t;                                            \
  t = n2[3] * n3[1] * s;                                             \
  v[54 * m] += n1[0] * t;                                            \
  v[55 * m] += n1[1] * t;                                            \
  v[56 * m] += n1[2] * t;                                            \
  v[57 * m] += n1[3] * t;                                            \
  v[58 * m] += n1[4] * t;                                            \
  v[59 * m] += n1[5] * t;                                            \
  t = n2[4] * n3[1] * s;                                             \
  v[60 * m] += n1[0] * t;                                            \
  v[61 * m] += n1[1] * t;                                            \
  v[62 * m] += n1[2] * t;                                            \
  v[63 * m] += n1[3] * t;                                            \
  v[64 * m] += n1[4] * t;                                            \
  v[65 * m] += n1[5] * t;                                            \
  t = n2[5] * n3[1] * s;                                             \
  v[66 * m] += n1[0] * t;                                            \
  v[67 * m] += n1[1] * t;                                            \
  v[68 * m] += n1[2] * t;                                            \
  v[69 * m] += n1[3] * t;                                            \
  v[70 * m] += n1[4] * t;                                            \
  v[71 * m] += n1[5] * t;                                            \
  t = n2[0] * n3[2] * s;                                             \
  v[72 * m] += n1[0] * t;                                            \
  v[73 * m] += n1[1] * t;                                            \
  v[74 * m] += n1[2] * t;                                            \
  v[75 * m] += n1[3] * t;                                            \
  v[76 * m] += n1[4] * t;                                            \
  v[77 * m] += n1[5] * t;                                            \
  t = n2[1] * n3[2] * s;                                             \
  v[78 * m] += n1[0] * t;                                            \
  v[79 * m] += n1[1] * t;                                            \
  v[80 * m] += n1[2] * t;                                            \
  v[81 * m] += n1[3] * t;                                            \
  v[82 * m] += n1[4] * t;                                            \
  v[83 * m] += n1[5] * t;                                            \
  t = n2[2] * n3[2] * s;                                             \
  v[84 * m] += n1[0] * t;                                            \
  v[85 * m] += n1[1] * t;                                            \
  v[86 * m] += n1[2] * t;                                            \
  v[87 * m] += n1[3] * t;                                            \
  v[88 * m] += n1[4] * t;                                            \
  v[89 * m] += n1[5] * t;                                            \
  t = n2[3] * n3[2] * s;                                             \
  v[90 * m] += n1[0] * t;                                            \
  v[91 * m] += n1[1] * t;                                            \
  v[92 * m] += n1[2] * t;                                            \
  v[93 * m] += n1[3] * t;                                            \
  v[94 * m] += n1[4] * t;                                            \
  v[95 * m] += n1[5] * t;                                            \
  t = n2[4] * n3[2] * s;                                             \
  v[96 * m] += n1[0] * t;                                            \
  v[97 * m] += n1[1] * t;                                            \
  v[98 * m] += n1[2] * t;                                            \
  v[99 * m] += n1[3] * t;                                            \
  v[100 * m] += n1[4] * t;                                           \
  v[101 * m] += n1[5] * t;                                           \
  t = n2[5] * n3[2] * s;                                             \
  v[102 * m] += n1[0] * t;                                           \
  v[103 * m] += n1[1] * t;                                           \
  v[104 * m] += n1[2] * t;                                           \
  v[105 * m] += n1[3] * t;                                           \
  v[106 * m] += n1[4] * t;                                           \
  v[107 * m] += n1[5] * t;                                           \
  t = n2[0] * n3[3] * s;                                             \
  v[108 * m] += n1[0] * t;                                           \
  v[109 * m] += n1[1] * t;                                           \
  v[110 * m] += n1[2] * t;                                           \
  v[111 * m] += n1[3] * t;                                           \
  v[112 * m] += n1[4] * t;                                           \
  v[113 * m] += n1[5] * t;                                           \
  t = n2[1] * n3[3] * s;                                             \
  v[114 * m] += n1[0] * t;                                           \
  v[115 * m] += n1[1] * t;                                           \
  v[116 * m] += n1[2] * t;                                           \
  v[117 * m] += n1[3] * t;                                           \
  v[118 * m] += n1[4] * t;                                           \
  v[119 * m] += n1[5] * t;                                           \
  t = n2[2] * n3[3] * s;                                             \
  v[120 * m] += n1[0] * t;                                           \
  v[121 * m] += n1[1] * t;                                           \
  v[122 * m] += n1[2] * t;                                           \
  v[123 * m] += n1[3] * t;                                           \
  v[124 * m] += n1[4] * t;                                           \
  v[125 * m] += n1[5] * t;                                           \
  t = n2[3] * n3[3] * s;                                             \
  v[126 * m] += n1[0] * t;                                           \
  v[127 * m] += n1[1] * t;                                           \
  v[128 * m] += n1[2] * t;                                           \
  v[129 * m] += n1[3] * t;                                           \
  v[130 * m] += n1[4] * t;                                           \
  v[131 * m] += n1[5] * t;                                           \
  t = n2[4] * n3[3] * s;                                             \
  v[132 * m] += n1[0] * t;                                           \
  v[133 * m] += n1[1] * t;                                           \
  v[134 * m] += n1[2] * t;                                           \
  v[135 * m] += n1[3] * t;                                           \
  v[136 * m] += n1[4] * t;                                           \
  v[137 * m] += n1[5] * t;                                           \
  t = n2[5] * n3[3] * s;                                             \
  v[138 * m] += n1[0] * t;                                           \
  v[139 * m] += n1[1] * t;                                           \
  v[140 * m] += n1[2] * t;                                           \
  v[141 * m] += n1[3] * t;                                           \
  v[142 * m] += n1[4] * t;                                           \
  v[143 * m] += n1[5] * t;                                           \
  t = n2[0] * n3[4] * s;                                             \
  v[144 * m] += n1[0] * t;                                           \
  v[145 * m] += n1[1] * t;                                           \
  v[146 * m] += n1[2] * t;                                           \
  v[147 * m] += n1[3] * t;                                           \
  v[148 * m] += n1[4] * t;                                           \
  v[149 * m] += n1[5] * t;                                           \
  t = n2[1] * n3[4] * s;                                             \
  v[150 * m] += n1[0] * t;                                           \
  v[151 * m] += n1[1] * t;                                           \
  v[152 * m] += n1[2] * t;                                           \
  v[153 * m] += n1[3] * t;                                           \
  v[154 * m] += n1[4] * t;                                           \
  v[155 * m] += n1[5] * t;                                           \
  t = n2[2] * n3[4] * s;                                             \
  v[156 * m] += n1[0] * t;                                           \
  v[157 * m] += n1[1] * t;                                           \
  v[158 * m] += n1[2] * t;                                           \
  v[159 * m] += n1[3] * t;                                           \
  v[160 * m] += n1[4] * t;                                           \
  v[161 * m] += n1[5] * t;                                           \
  t = n2[3] * n3[4] * s;                                             \
  v[162 * m] += n1[0] * t;                                           \
  v[163 * m] += n1[1] * t;                                           \
  v[164 * m] += n1[2] * t;                                           \
  v[165 * m] += n1[3] * t;                                           \
  v[166 * m] += n1[4] * t;                                           \
  v[167 * m] += n1[5] * t;                                           \
  t = n2[4] * n3[4] * s;                                             \
  v[168 * m] += n1[0] * t;                                           \
  v[169 * m] += n1[1] * t;                                           \
  v[170 * m] += n1[2] * t;                                           \
  v[171 * m] += n1[3] * t;                                           \
  v[172 * m] += n1[4] * t;                                           \
  v[173 * m] += n1[5] * t;                                           \
  t = n2[5] * n3[4] * s;                                             \
  v[174 * m] += n1[0] * t;                                           \
  v[175 * m] += n1[1] * t;                                           \
  v[176 * m] += n1[2] * t;                                           \
  v[177 * m] += n1[3] * t;                                           \
  v[178 * m] += n1[4] * t;                                           \
  v[179 * m] += n1[5] * t;                                           \
  t = n2[0] * n3[5] * s;                                             \
  v[180 * m] += n1[0] * t;                                           \
  v[181 * m] += n1[1] * t;                                           \
  v[182 * m] += n1[2] * t;                                           \
  v[183 * m] += n1[3] * t;                                           \
  v[184 * m] += n1[4] * t;                                           \
  v[185 * m] += n1[5] * t;                                           \
  t = n2[1] * n3[5] * s;                                             \
  v[186 * m] += n1[0] * t;                                           \
  v[187 * m] += n1[1] * t;                                           \
  v[188 * m] += n1[2] * t;                                           \
  v[189 * m] += n1[3] * t;                                           \
  v[190 * m] += n1[4] * t;                                           \
  v[191 * m] += n1[5] * t;                                           \
  t = n2[2] * n3[5] * s;                                             \
  v[192 * m] += n1[0] * t;                                           \
  v[193 * m] += n1[1] * t;                                           \
  v[194 * m] += n1[2] * t;                                           \
  v[195 * m] += n1[3] * t;                                           \
  v[196 * m] += n1[4] * t;                                           \
  v[197 * m] += n1[5] * t;                                           \
  t = n2[3] * n3[5] * s;                                             \
  v[198 * m] += n1[0] * t;                                           \
  v[199 * m] += n1[1] * t;                                           \
  v[200 * m] += n1[2] * t;                                           \
  v[201 * m] += n1[3] * t;                                           \
  v[202 * m] += n1[4] * t;                                           \
  v[203 * m] += n1[5] * t;                                           \
  t = n2[4] * n3[5] * s;                                             \
  v[204 * m] += n1[0] * t;                                           \
  v[205 * m] += n1[1] * t;                                           \
  v[206 * m] += n1[2] * t;                                           \
  v[207 * m] += n1[3] * t;                                           \
  v[208 * m] += n1[4] * t;                                           \
  v[209 * m] += n1[5] * t;                                           \
  t = n2[5] * n3[5] * s;                                             \
  v[210 * m] += n1[0] * t;                                           \
  v[211 * m] += n1[1] * t;                                           \
  v[212 * m] += n1[2] * t;                                           \
  v[213 * m] += n1[3] * t;                                           \
  v[214 * m] += n1[4] * t;                                           \
  v[215 * m] += n1[5] * t;

#endif  // TACS_BASIS_MACROS_H