#!/bin/bash

helpstring="

This command will find all directories from the current directory down that contain .f5 files and run f5convert_all in each one.
This can be very useful for converting a large number of .f5 files from numerous TACS cases that output to different directories.
"

if [ "$1" == "-h" ]; then
	echo "$helpstring"
	exit 0
fi

if ! command -v parallel &> /dev/null
then
    echo "parallel could not be found, please install it to use f5convert_subdirs"
    exit
fi

COMMAND='f5convert_all'
RootDir=$(pwd)
find . -iname '*.f5' -printf '%h\n' | sort -u | while read i; do
    cd "$i" && pwd && $COMMAND ; cd "$RootDir"
done
